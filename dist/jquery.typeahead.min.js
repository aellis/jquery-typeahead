/*!
 * jQuery Typeahead
 * Copyright (C) 2016 RunningCoder.org
 * Licensed under the MIT license
 *
 * @author Tom Bertrand
 * @version 2.7.6 (2016-12-23)
 * @link http://www.runningcoder.org/jquerytypeahead/
 */
!function(a){"function"==typeof define&&define.amd?define("jquery-typeahead",["jquery"],function(b){return a(b)}):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===b&&(b="undefined"!=typeof window?require("jquery"):require("jquery")(c)),a(b)}():a(jQuery)}(function(a){"use strict";window.Typeahead={version:"2.7.6"};var b={input:null,minLength:2,maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,suggestion:!1,searchOnFocus:!1,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,groupTemplate:null,correlativeTemplate:!1,emptyTemplate:!1,cancelButton:!0,loadingAnimation:!0,filter:!0,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onMouseEnter:null,onMouseLeave:null,onClickBefore:null,onClickAfter:null,onDropdownFilter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null,onCancel:null},selector:{container:"typeahead__container",result:"typeahead__result",list:"typeahead__list",group:"typeahead__group",item:"typeahead__item",empty:"typeahead__empty",display:"typeahead__display",query:"typeahead__query",filter:"typeahead__filter",filterButton:"typeahead__filter-button",dropdown:"typeahead__dropdown",dropdownItem:"typeahead__dropdown-item",button:"typeahead__button",backdrop:"typeahead__backdrop",hint:"typeahead__hint",cancelButton:"typeahead__cancel-button"},debug:!1},c=".typeahead",d={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"},e=~window.navigator.appVersion.indexOf("MSIE 9."),f=~window.navigator.appVersion.indexOf("MSIE 10"),g=~window.navigator.userAgent.indexOf("Trident")&&~window.navigator.userAgent.indexOf("rv:11"),h=function(a,b){this.rawQuery=a.val()||"",this.query=a.val()||"",this.namespace="."+c,this.tmpSource={},this.source={},this.isGenerated=null,this.generatedGroupCount=0,this.groupCount=0,this.groupBy="group",this.groups=[],this.result={},this.groupTemplate="",this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=b,this.node=a,this.namespace="."+this.helper.slugify.call(this,a.selector)+c,this.container=null,this.resultContainer=null,this.item=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.dropdownFilter={static:[],dynamic:[]},this.dropdownFilterAll=null,this.isDropdownEvent=!1,this.requests={},this.backdrop={},this.hint={},this.hasDragged=!1,this.focusOnly=!1,this.__construct()};h.prototype={extendOptions:function(){this.options.dynamic&&(this.options.cache=!1,this.options.compression=!1);var c=this;if(this.options.cache&&(this.options.cache=function(a){var d,b=["localStorage","sessionStorage"];if(a===!0)a="localStorage";else if("string"==typeof a&&!~b.indexOf(a))return c.options.debug&&(j.log({node:c.node.selector,function:"extendOptions()",message:'Invalid options.cache, possible options are "localStorage" or "sessionStorage"'}),j.print()),!1;d="undefined"!=typeof window[a];try{window[a].setItem("typeahead","typeahead"),window[a].removeItem("typeahead")}catch(a){d=!1}return d&&a||!1}.call(this,this.options.cache)),this.options.compression&&("object"==typeof LZString&&this.options.cache||(this.options.debug&&(j.log({node:this.node.selector,function:"extendOptions()",message:"Missing LZString Library or options.cache, no compression will occur."}),j.print()),this.options.compression=!1)),"undefined"==typeof this.options.maxItem||/^\d+$/.test(this.options.maxItem)&&0!==this.options.maxItem||(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),this.options.display&&!Array.isArray(this.options.display)&&(this.options.display=[this.options.display]),this.options.group&&(Array.isArray(this.options.group)?this.options.debug&&(j.log({node:this.node.selector,function:"extendOptions()",message:"options.group must be a boolean|string|object as of 2.5.0"}),j.print()):("string"==typeof this.options.group?this.options.group={key:this.options.group}:"boolean"==typeof this.options.group&&(this.options.group={key:"group"}),this.options.group.key=this.options.group.key||"group")),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),this.options.dropdownFilter&&this.options.dropdownFilter instanceof Object){Array.isArray(this.options.dropdownFilter)||(this.options.dropdownFilter=[this.options.dropdownFilter]);for(var e=0,f=this.options.dropdownFilter.length;e<f;++e)this.dropdownFilter[this.options.dropdownFilter[e].value?"static":"dynamic"].push(this.options.dropdownFilter[e])}this.options.dynamicFilter&&!Array.isArray(this.options.dynamicFilter)&&(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"==typeof this.options.accent?this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length===this.options.accent.to.length||this.options.debug&&(j.log({node:this.node.selector,function:"extendOptions()",message:'Invalid "options.accent", from and to must be defined and same length.'}),j.print()):this.options.accent=d),this.options.groupTemplate&&(this.groupTemplate=this.options.groupTemplate),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=a(this.options.resultContainer)),this.options.resultContainer instanceof a&&this.options.resultContainer[0]?this.resultContainer=this.options.resultContainer:this.options.debug&&(j.log({node:this.node.selector,function:"extendOptions()",message:'Invalid jQuery selector or jQuery Object for "options.resultContainer".'}),j.print())),this.options.maxItemPerGroup&&this.options.group&&this.options.group.key&&(this.groupBy=this.options.group.key),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=a.extend(!0,{},b,this.options)},unifySourceFormat:function(){if(this.groupCount=0,Array.isArray(this.options.source))return this.options.source={group:{data:this.options.source}},this.groupCount=1,!0;"string"==typeof this.options.source&&(this.options.source={group:{ajax:{url:this.options.source}}}),this.options.source.ajax&&(this.options.source={group:{ajax:this.options.source.ajax}}),(this.options.source.url||this.options.source.data)&&(this.options.source={group:this.options.source});var a,b,c;for(a in this.options.source)if(this.options.source.hasOwnProperty(a)){if(b=this.options.source[a],"string"==typeof b&&(b={ajax:{url:b}}),c=b.url||b.ajax,Array.isArray(c)?(b.ajax="string"==typeof c[0]?{url:c[0]}:c[0],b.ajax.path=b.ajax.path||c[1]||null,delete b.url):("object"==typeof b.url?b.ajax=b.url:"string"==typeof b.url&&(b.ajax={url:b.url}),delete b.url),!b.data&&!b.ajax)return this.options.debug&&(j.log({node:this.node.selector,function:"unifySourceFormat()",arguments:JSON.stringify(this.options.source),message:'Undefined "options.source.'+a+'.[data|ajax]" is Missing - Typeahead dropped'}),j.print()),!1;b.display&&!Array.isArray(b.display)&&(b.display=[b.display]),this.options.source[a]=b,this.groupCount++}return!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container),this.options.debug&&(j.log({node:this.node.selector,function:"init()",message:"OK - Typeahead activated on "+this.node.selector}),j.print())},delegateEvents:function(){var b=this,c=["focus"+this.namespace,"input"+this.namespace,"propertychange"+this.namespace,"keydown"+this.namespace,"keyup"+this.namespace,"dynamic"+this.namespace,"generate"+this.namespace];a("html").on("touchmove",function(){b.hasDragged=!0}).on("touchstart",function(){b.hasDragged=!1}),this.node.closest("form").on("submit",function(a){return b.options.mustSelectItem&&b.helper.isEmpty(b.item)?void a.preventDefault():(b.options.backdropOnFocus||b.hideLayout(),b.options.callback.onSubmit?b.helper.executeCallback.call(b,b.options.callback.onSubmit,[b.node,this,b.item,a]):void 0)}).on("reset",function(){setTimeout(function(){b.node.trigger("input"+b.namespace),b.hideLayout()})});var d=!1;if(this.node.attr("placeholder")&&(f||g)){var h=!0;this.node.on("focusin focusout",function(){h=!(this.value||!this.placeholder)}),this.node.on("input",function(a){h&&(a.stopImmediatePropagation(),h=!1)})}this.node.off(this.namespace).on(c.join(" "),function(a,c){switch(a.type){case"generate":b.isGenerated=null,b.generateSource();break;case"focus":if(b.focusOnly){b.focusOnly=!1;break}b.options.backdropOnFocus&&(b.buildBackdropLayout(),b.showLayout()),b.options.searchOnFocus&&b.query.length>=b.options.minLength&&(b.isGenerated?b.showLayout():null===b.isGenerated&&b.generateSource());break;case"keydown":a.keyCode&&~[9,13,27,38,39,40].indexOf(a.keyCode)&&(d=!0,b.navigate(a));break;case"keyup":null!==b.isGenerated||b.options.dynamic||b.generateSource(),e&&b.node[0].value.replace(/^\s+/,"").toString().length<b.query.length&&b.node.trigger("input"+b.namespace);break;case"propertychange":if(d){d=!1;break}case"input":if(b.rawQuery=b.node[0].value.toString(),b.query=b.rawQuery.replace(/^\s+/,""),""===b.rawQuery&&""===b.query&&(a.originalEvent=c||{},b.helper.executeCallback.call(b,b.options.callback.onCancel,[b.node,a])),b.options.cancelButton&&b.toggleCancelButton(),b.options.hint&&b.hint.container&&""!==b.hint.container.val()&&0!==b.hint.container.val().indexOf(b.rawQuery)&&b.hint.container.val(""),b.options.dynamic)return b.isGenerated=null,void b.helper.typeWatch(function(){b.query.length>=b.options.minLength?b.generateSource():b.hideLayout()},b.options.delay);case"dynamic":if(!b.isGenerated)break;b.searchResult(),b.buildLayout(),(b.result.length>0||b.options.emptyTemplate&&""!==b.query)&&b.query.length>=b.options.minLength?b.showLayout():b.hideLayout()}}),this.options.generateOnLoad&&this.node.trigger("generate"+this.namespace)},generateSource:function(){if(!this.isGenerated||this.options.dynamic){if(this.generatedGroupCount=0,this.isGenerated=!1,this.options.loadingAnimation&&this.container.addClass("loading"),!this.helper.isEmpty(this.xhr)){for(var b in this.xhr)this.xhr.hasOwnProperty(b)&&this.xhr[b].abort();this.xhr={}}var d,e,f,g,h,c=this;for(d in this.options.source)if(this.options.source.hasOwnProperty(d)){if(f=this.options.source[d],this.options.cache&&(g=window[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+d))){this.options.compression&&(g=LZString.decompressFromUTF16(g)),h=!1;try{g=JSON.parse(g+""),g.data&&g.ttl>(new Date).getTime()?(this.populateSource(g.data,d),h=!0,this.options.debug&&(j.log({node:this.node.selector,function:"generateSource()",message:'Source for group "'+d+'" found in '+this.options.cache}),j.print())):window[this.options.cache].removeItem("TYPEAHEAD_"+this.node.selector+":"+d)}catch(a){}if(h)continue}!f.data||f.ajax?f.ajax&&(this.requests[d]||(this.requests[d]=this.generateRequestObject(d))):"function"==typeof f.data?(e=f.data.call(this),Array.isArray(e)?c.populateSource(e,d):"function"==typeof e.promise&&!function(b){a.when(e).then(function(a){a&&Array.isArray(a)&&c.populateSource(a,b)})}(d)):this.populateSource(a.extend(!0,[],f.data),d)}this.handleRequests()}},generateRequestObject:function(a){var b=this,c=this.options.source[a],d={request:{url:c.ajax.url||null,dataType:"json",beforeSend:function(d,e){b.xhr[a]=d;var f=b.requests[a].callback.beforeSend||c.ajax.beforeSend;"function"==typeof f&&f.apply(null,arguments)}},callback:{beforeSend:null,done:null,fail:null,then:null,always:null},extra:{path:c.ajax.path||null,group:a},validForGroup:[a]};if("function"!=typeof c.ajax&&(c.ajax instanceof Object&&(d=this.extendXhrObject(d,c.ajax)),Object.keys(this.options.source).length>1))for(var e in this.requests)this.requests.hasOwnProperty(e)&&(this.requests[e].isDuplicated||d.request.url&&d.request.url===this.requests[e].request.url&&(this.requests[e].validForGroup.push(a),d.isDuplicated=!0,delete d.validForGroup));return d},extendXhrObject:function(b,c){return"object"==typeof c.callback&&(b.callback=c.callback,delete c.callback),"function"==typeof c.beforeSend&&(b.callback.beforeSend=c.beforeSend,delete c.beforeSend),b.request=a.extend(!0,b.request,c),"jsonp"!==b.request.dataType.toLowerCase()||b.request.jsonpCallback||(b.request.jsonpCallback="callback_"+b.extra.group),b},handleRequests:function(){var b=this,c=Object.keys(this.requests).length;if(this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query])===!1)return void(this.isGenerated=null);for(var d in this.requests)this.requests.hasOwnProperty(d)&&(this.requests[d].isDuplicated||!function(d,e){if("function"==typeof b.options.source[d].ajax){var f=b.options.source[d].ajax.call(b,b.query);if(e=b.extendXhrObject(b.generateRequestObject(d),"object"==typeof f?f:{}),"object"!=typeof e.request||!e.request.url)return b.options.debug&&(j.log({node:b.node.selector,function:"handleRequests",message:'Source function must return an object containing ".url" key for group "'+d+'"'}),j.print()),void b.populateSource([],d);b.requests[d]=e}var g,i,h=!1;if(~e.request.url.indexOf("{{query}}")&&(h||(e=a.extend(!0,{},e),h=!0),e.request.url=e.request.url.replace("{{query}}",encodeURIComponent(b.query))),e.request.data)for(var k in e.request.data)if(e.request.data.hasOwnProperty(k)&&~String(e.request.data[k]).indexOf("{{query}}")){h||(e=a.extend(!0,{},e),h=!0),e.request.data[k]=e.request.data[k].replace("{{query}}",b.query);break}a.ajax(e.request).done(function(a,c,d){i=null;for(var f=0,h=e.validForGroup.length;f<h;f++)g=b.requests[e.validForGroup[f]],g.callback.done instanceof Function&&(i=g.callback.done(a,c,d),Array.isArray(i)&&"object"==typeof i||b.options.debug&&(j.log({node:b.node.selector,function:"Ajax.callback.done()",message:"Invalid returned data has to be an Array"}),j.print()))}).fail(function(a,c,d){for(var f=0,h=e.validForGroup.length;f<h;f++)g=b.requests[e.validForGroup[f]],g.callback.fail instanceof Function&&g.callback.fail(a,c,d);b.options.debug&&(j.log({node:b.node.selector,function:"Ajax.callback.fail()",arguments:JSON.stringify(e.request),message:c}),console.log(d),j.print())}).always(function(a,d,f){for(var h=0,j=e.validForGroup.length;h<j;h++)g=b.requests[e.validForGroup[h]],g.callback.always instanceof Function&&g.callback.always(a,d,f),b.populateSource("function"==typeof a.promise&&[]||i||a,g.extra.group,g.extra.path||g.request.path),c-=1,0===c&&b.helper.executeCallback.call(b,b.options.callback.onReceiveRequest,[b.node,b.query])}).then(function(a,c){for(var d=0,f=e.validForGroup.length;d<f;d++)g=b.requests[e.validForGroup[d]],g.callback.then instanceof Function&&g.callback.then(a,c)})}(d,this.requests[d]))},populateSource:function(a,b,c){var d=this,e=this.options.source[b],f=e.ajax&&e.data;a="string"==typeof c?this.helper.namespace(c,a):a,"undefined"==typeof a&&this.options.debug&&(j.log({node:this.node.selector,function:"populateSource()",arguments:c,message:"Invalid data path."}),j.print()),Array.isArray(a)||(this.options.debug&&(j.log({node:this.node.selector,function:"populateSource()",arguments:JSON.stringify({group:b}),message:"Invalid data type, must be Array type."}),j.print()),a=[]),f&&("function"==typeof f&&(f=f()),Array.isArray(f)?a=a.concat(f):this.options.debug&&(j.log({node:this.node.selector,function:"populateSource()",arguments:JSON.stringify(f),message:"WARNING - this.options.source."+b+".data Must be an Array or a function that returns an Array."}),j.print()));for(var g,h=e.display?"compiled"===e.display[0]?e.display[1]:e.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],i=0,k=a.length;i<k;i++)null!==a[i]&&"boolean"!=typeof a[i]?("string"==typeof a[i]&&(g={},g[h]=a[i],a[i]=g),a[i].group=b):this.options.debug&&(j.log({node:this.node.selector,function:"populateSource()",message:"WARNING - NULL/BOOLEAN value inside "+b+"! The data was skipped."}),j.print());if(!this.options.dynamic&&this.dropdownFilter.dynamic.length)for(var l,m,n={},i=0,k=a.length;i<k;i++)for(var o=0,p=this.dropdownFilter.dynamic.length;o<p;o++)l=this.dropdownFilter.dynamic[o].key,m=a[i][l],m&&(this.dropdownFilter.dynamic[o].value||(this.dropdownFilter.dynamic[o].value=[]),n[l]||(n[l]=[]),~n[l].indexOf(m.toLowerCase())||(n[l].push(m.toLowerCase()),this.dropdownFilter.dynamic[o].value.push(m)));if(this.options.correlativeTemplate){var q=e.template||this.options.template,r="";if("function"==typeof q&&(q=q.call(this,"",{})),q){if(Array.isArray(this.options.correlativeTemplate))for(var i=0,k=this.options.correlativeTemplate.length;i<k;i++)r+="{{"+this.options.correlativeTemplate[i]+"}} ";else r=q.replace(/<.+?>/g,"");for(var i=0,k=a.length;i<k;i++)a[i].compiled=r.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(b,c){return d.helper.namespace(c,a[i],"get","")}).trim();e.display?~e.display.indexOf("compiled")||e.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}else this.options.debug&&(j.log({node:this.node.selector,function:"populateSource()",arguments:JSON.stringify(b),message:"WARNING - this.options.correlativeTemplate is enabled but no template was found."}),j.print())}if(this.options.callback.onPopulateSource&&(a=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,a,b,c]),this.options.debug&&(a&&Array.isArray(a)||(j.log({node:this.node.selector,function:"callback.populateSource()",message:'callback.onPopulateSource must return the "data" parameter'}),j.print()))),this.tmpSource[b]=a,this.options.cache&&!window[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+b)){this.options.callback.onCacheSave&&(a=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,a,b,c]),this.options.debug&&(a&&Array.isArray(a)||(j.log({node:this.node.selector,function:"callback.populateSource()",message:'callback.onCacheSave must return the "data" parameter'}),j.print())));var s=JSON.stringify({data:a,ttl:(new Date).getTime()+this.options.ttl});this.options.compression&&(s=LZString.compressToUTF16(s)),window[this.options.cache].setItem("TYPEAHEAD_"+this.node.selector+":"+b,s)}this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){if(this.generatedGroupCount++,this.groupCount===this.generatedGroupCount){this.isGenerated=!0,this.xhr={};for(var a=Object.keys(this.options.source),b=0,c=a.length;b<c;b++)this.source[a[b]]=this.tmpSource[a[b]];this.tmpSource={},this.options.dynamic||this.buildDropdownItemLayout("dynamic"),this.options.loadingAnimation&&this.container.removeClass("loading"),this.node.trigger("dynamic"+this.namespace)}},navigate:function(a){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,a]),27===a.keyCode)return a.preventDefault(),void(this.query.length?(this.resetInput(),this.node.trigger("input"+this.namespace,[a])):(this.node.blur(),this.hideLayout()));if(this.isGenerated&&this.result.length){var b=this.resultContainer.find("."+this.options.selector.item),c=b.filter(".active"),d=c[0]&&b.index(c)||null,e=null;if(13===a.keyCode)return void(c.length>0&&(a.preventDefault(),c.find("a:first").trigger("click",a)));if(39===a.keyCode)return void(d?b.eq(d).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&b.find('a[data-index="'+this.hintIndex+'"]')[0].click());b.length>0&&c.removeClass("active"),38===a.keyCode?(a.preventDefault(),c.length>0?d-1>=0&&(e=d-1,b.eq(e).addClass("active")):(e=b.length-1,b.last().addClass("active"))):40===a.keyCode&&(a.preventDefault(),c.length>0?d+1<b.length&&(e=d+1,b.eq(e).addClass("active")):(e=0,b.first().addClass("active"))),a.preventInputChange&&~[38,40].indexOf(a.keyCode)&&this.buildHintLayout(null!==e&&e<this.result.length?[this.result[e]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",a.preventInputChange?this.hint.css.color:null===e&&this.hint.css.color||this.hint.container.css("background-color")||"fff"),this.node.val(null===e||a.preventInputChange?this.rawQuery:this.result[e][this.result[e].matchedKey]),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,b,null!==e&&b.eq(e).find("a:first")||void 0,null!==e&&this.result[e]||void 0,this.query,a])}},searchResult:function(a){a||(this.item={}),this.resetLayout(),this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])!==!1&&(this.query.length>=this.options.minLength&&this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]),this.isDropdownEvent&&(this.helper.executeCallback.call(this,this.options.callback.onDropdownFilter,[this.node,this.query,this.filters.dropdown,this.result]),this.isDropdownEvent=!1))},searchResultData:function(){var b,e,f,g,l,m,o,p,q,r,t,u,v,a=this,c=this.groupBy,d=null,h=this.query.toLowerCase(),i=this.options.maxItemPerGroup,k=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),n={},s="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(h=this.helper.removeAccent.call(this,h));for(b in this.source)if(this.source.hasOwnProperty(b)&&(!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===b)){o="undefined"!=typeof this.options.source[b].filter?this.options.source[b].filter:this.options.filter,q="function"==typeof this.options.source[b].matcher&&this.options.source[b].matcher||s;for(var w=0,x=this.source[b].length;w<x&&(!(this.result.length>=this.options.maxItem)||this.options.callback.onResult);w++)if((!k||this.dynamicFilter.validate.apply(this,[this.source[b][w]]))&&(e=this.source[b][w],null!==e&&"boolean"!=typeof e&&(!this.filters.dropdown||(e[this.filters.dropdown.key]||"").toLowerCase()===(this.filters.dropdown.value||"").toLowerCase()))){if(d="group"===c?b:e[c],d&&!this.result[d]&&(this.result[d]=[],this.resultCountPerGroup[d]=0),i&&"group"===c&&this.result[d].length>=i&&!this.options.callback.onResult)break;l=this.options.source[b].display||this.options.display;for(var y=0,z=l.length;y<z;y++){m=/\./.test(l[y])?this.helper.namespace(l[y],e):e[l[y]];{if("undefined"!=typeof m&&""!==m){if(m=this.helper.cleanStringFromScript(m),"function"==typeof o){if(p=o.call(this,e,m),void 0===p)break;if(!p)continue;"object"==typeof p&&(e=p)}if(~[void 0,!0].indexOf(o)){if(g=m,g=g.toString().toLowerCase(),this.options.accent&&(g=this.helper.removeAccent.call(this,g)),f=g.indexOf(h),this.options.correlativeTemplate&&"compiled"===l[y]&&f<0&&/\s/.test(h)){t=!0,u=h.split(" "),v=g;for(var A=0,B=u.length;A<B;A++)if(""!==u[A]){if(!~v.indexOf(u[A])){t=!1;break}v=v.replace(u[A],"")}}if(f<0&&!t)continue;if(this.options.offset&&0!==f)continue;if(q){if(r=q.call(this,e,m),void 0===r)break;if(!r)continue;"object"==typeof r&&(e=r)}}if(this.resultCount++,this.resultCountPerGroup[d]++,this.resultItemCount<this.options.maxItem){if(i&&this.result[d].length>=i)break;e.matchedKey=l[y],this.result[d].push(e),this.resultItemCount++}break}this.options.debug&&(n[y]={display:l[y],data:e})}}if(!this.options.callback.onResult){if(this.resultItemCount>=this.options.maxItem)break;if(i&&this.result[d].length>=i&&"group"===c)break}}}if(this.options.debug&&(this.helper.isEmpty(n)||(j.log({node:this.node.selector,function:"searchResult()",arguments:JSON.stringify(n),message:"Missing keys for display, make sure options.display is set properly."}),j.print())),this.options.order){var C,l=[];for(var b in this.result)if(this.result.hasOwnProperty(b)){for(var y=0,z=this.result[b].length;y<z;y++)C=this.options.source[this.result[b][y].group].display||this.options.display,~l.indexOf(C[0])||l.push(C[0]);this.result[b].sort(a.helper.sort(l,"asc"===a.options.order,function(a){return a.toString().toUpperCase()}))}}var E,D=[];E="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]):Array.isArray(this.options.groupOrder)?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.result).sort(a.helper.sort([],"asc"===a.options.groupOrder,function(a){return a.toString().toUpperCase()})):Object.keys(this.result),this.groups=E;for(var y=0,z=E.length;y<z;y++)D=D.concat(this.result[E[y]]||[]);this.result=D},buildLayout:function(){if(this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore){var b=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml]);b instanceof a?this.resultHtml=b:this.options.debug&&(j.log({node:this.node.selector,function:"callback.onLayoutBuiltBefore()",message:"Invalid returned value - You must return resultHtmlList jQuery Object"}),j.print())}this.resultHtml&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(this.options.resultContainer!==!1){this.resultContainer||(this.resultContainer=a("<div/>",{class:this.options.selector.result}),this.container.append(this.resultContainer));var b;if(!this.result.length){if(!this.options.emptyTemplate||""===this.query)return;b="function"==typeof this.options.emptyTemplate?this.options.emptyTemplate.call(this,this.query):this.options.emptyTemplate.replace(/\{\{query}}/gi,this.helper.cleanStringFromScript(this.query))}var c=this.query.toLowerCase();this.options.accent&&(c=this.helper.removeAccent.call(this,c));var d=this,e=this.groupTemplate||"<ul></ul>",f=!1;this.groupTemplate?e=a(e.replace(/<([^>]+)>\{\{(.+?)}}<\/[^>]+>/g,function(a,c,e,g,h){var i="",j="group"===e?d.groups:[e];if(!d.result.length)return f===!0?"":(f=!0,"<"+c+' class="'+d.options.selector.empty+'"><a href="javascript:;">'+b+"</a></"+c+">");for(var k=0,l=j.length;k<l;++k)i+="<"+c+' data-group-template="'+j[k]+'"><ul></ul></'+c+">";return i})):(e=a(e),this.result.length||e.append(b instanceof a?b:'<li class="'+d.options.selector.empty+'"><a href="javascript:;">'+b+"</a></li>")),e.addClass(this.options.selector.list+(this.helper.isEmpty(this.result)?" empty":""));for(var g,h,i,j,k,l,m,n,o,p,r,q=this.groupTemplate&&this.result.length&&d.groups||[],s=0,t=this.result.length;s<t;++s)i=this.result[s],g=i.group,j=this.options.source[i.group].href||this.options.href,n=[],o=this.options.source[i.group].display||this.options.display,this.options.group&&(g=i[this.options.group.key],this.options.group.template&&("function"==typeof this.options.group.template?h=this.options.group.template(i):"string"==typeof this.options.template&&(h=this.options.group.template.replace(/\{\{([\w\-\.]+)}}/gi,function(a,b){return d.helper.namespace(b,i,"get","")}))),e.find('[data-search-group="'+g+'"]')[0]||(this.groupTemplate?e.find('[data-group-template="'+g+'"] ul'):e).append(a("<li/>",{class:d.options.selector.group,html:a("<a/>",{href:"javascript:;",html:h||g,tabindex:-1}),"data-search-group":g}))),this.groupTemplate&&q.length&&(r=q.indexOf(g||i.group),~r&&q.splice(r,1)),k=a("<li/>",{class:d.options.selector.item+" "+d.options.selector.group+"-"+this.helper.slugify.call(this,g),html:a("<a/>",{href:function(){return j&&("string"==typeof j?j=j.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(a,b,c){var e=d.helper.namespace(b,i,"get","");return c=c&&c.split("|")||[],~c.indexOf("slugify")&&(e=d.helper.slugify.call(d,e)),e}):"function"==typeof j&&(j=j(i)),i.href=j),j||"javascript:;"}(),"data-group":g,"data-index":s,html:function(){if(l=i.group&&d.options.source[i.group].template||d.options.template)"function"==typeof l&&(l=l.call(d,d.query,i)),m=l.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(a,b,e){var f=d.helper.cleanStringFromScript(String(d.helper.namespace(b,i,"get","")));return e=e&&e.split("|")||[],~e.indexOf("slugify")&&(f=d.helper.slugify.call(d,f)),~e.indexOf("raw")||d.options.highlight===!0&&c&&~o.indexOf(b)&&(f=d.helper.highlight.call(d,f,c.split(" "),d.options.accent)),f});else{for(var b=0,e=o.length;b<e;b++)p=/\./.test(o[b])?d.helper.namespace(o[b],i):i[o[b]],"undefined"!=typeof p&&""!==p&&n.push(p);m='<span class="'+d.options.selector.display+'">'+d.helper.cleanStringFromScript(String(n.join(" ")))+"</span>"}(d.options.highlight===!0&&c&&!l||"any"===d.options.highlight)&&(m=d.helper.highlight.call(d,m,c.split(" "),d.options.accent)),a(this).append(m)}})}),function(b,c,e){e.on("click",function(b,e){return e&&"object"==typeof e&&(b.originalEvent=e),d.options.mustSelectItem&&d.helper.isEmpty(c)?void b.preventDefault():(d.item=c,void(d.helper.executeCallback.call(d,d.options.callback.onClickBefore,[d.node,a(this),c,b])!==!1&&(b.originalEvent&&b.originalEvent.defaultPrevented||b.isDefaultPrevented()||(d.query=d.rawQuery=c[c.matchedKey].toString(),d.focusOnly=!0,d.node.val(d.query).focus(),d.searchResult(!0),d.buildLayout(),d.hideLayout(),d.helper.executeCallback.call(d,d.options.callback.onClickAfter,[d.node,a(this),c,b])))))}),e.on("mouseenter",function(b){d.helper.executeCallback.call(d,d.options.callback.onMouseEnter,[d.node,a(this),c,b])}),e.on("mouseleave",function(b){d.helper.executeCallback.call(d,d.options.callback.onMouseLeave,[d.node,a(this),c,b])})}(s,i,k),(this.groupTemplate?e.find('[data-group-template="'+g+'"] ul'):e).append(k);if(this.result.length&&q.length)for(var s=0,t=q.length;s<t;++s)e.find('[data-group-template="'+q[s]+'"]').remove();this.resultHtml=e}},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=a.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=a("<div/>",{class:this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(b){if(this.options.hint){if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth()))return void(this.hint.container&&this.hint.container.val(""));var c=this,d="",b=b||this.result,e=this.query.toLowerCase();if(this.options.accent&&(e=this.helper.removeAccent.call(this,e)),this.hintIndex=null,this.query.length>=this.options.minLength){if(this.hint.container||(this.hint.css=a.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,float:"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=a("<input/>",{type:this.node.attr("type"),class:this.node.attr("class"),readonly:!0,unselectable:"on","aria-hidden":"true",tabindex:-1,click:function(){c.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),e)for(var f,g,h,i=0,j=b.length;i<j;i++){g=b[i].group,f=this.options.source[g].display||this.options.display;for(var k=0,l=f.length;k<l;k++)if(h=String(b[i][f[k]]).toLowerCase(),this.options.accent&&(h=this.helper.removeAccent.call(this,h)),0===h.indexOf(e)){
d=String(b[i][f[k]]),this.hintIndex=i;break}if(null!==this.hintIndex)break}this.hint.container.val(d.length>0&&this.rawQuery+d.substring(this.query.length)||"")}}},buildDropdownLayout:function(){if(this.options.dropdownFilter){var b=this;a("<span/>",{class:this.options.selector.filter,html:function(){a(this).append(a("<button/>",{type:"button",class:b.options.selector.filterButton,style:"display: none;",click:function(c){c.stopPropagation(),b.container.toggleClass("filter");var d=b.namespace+"-dropdown-filter";a("html").off(d),b.container.hasClass("filter")&&a("html").on("click"+d+" touchend"+d,function(c){a(c.target).closest("."+b.options.selector.filter)[0]||b.hasDragged||b.container.removeClass("filter")})}})),a(this).append(a("<ul/>",{class:b.options.selector.dropdown}))}}).insertAfter(b.container.find("."+b.options.selector.query))}},buildDropdownItemLayout:function(b){function l(a){"*"===a.value?delete this.filters.dropdown:this.filters.dropdown=a,this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(a.template),this.isDropdownEvent=!0,this.node.trigger("dynamic"+this.namespace),this.node.focus()}var d,g,c=this,e="string"==typeof this.options.dropdownFilter&&this.options.dropdownFilter||"All",f=this.container.find("."+this.options.selector.dropdown);("static"===b&&this.options.dropdownFilter===!0||"string"==typeof this.options.dropdownFilter)&&this.dropdownFilter.static.push({key:"group",template:"{{group}}",all:e,value:Object.keys(this.options.source)});for(var h=0,i=this.dropdownFilter[b].length;h<i;h++){g=this.dropdownFilter[b][h],Array.isArray(g.value)||(g.value=[g.value]),g.all&&(this.dropdownFilterAll=g.all);for(var j=0,k=g.value.length;j<=k;j++)j===k&&h!==i-1||j===k&&h===i-1&&"static"===b&&this.dropdownFilter.dynamic.length||(d=this.dropdownFilterAll||e,g.value[j]?d=g.template?g.template.replace(new RegExp("{{"+g.key+"}}","gi"),g.value[j]):g.value[j]:this.container.find("."+c.options.selector.filterButton).html(d),function(b,d,g){f.append(a("<li/>",{class:c.options.selector.dropdownItem+" "+c.helper.slugify.call(c,d.key+"-"+(d.value[b]||e)),html:a("<a/>",{href:"javascript:;",html:g,click:function(a){a.preventDefault(),l.call(c,{key:d.key,value:d.value[b]||"*",template:g})}})}))}(j,g,d))}this.dropdownFilter[b].length&&this.container.find("."+c.options.selector.filterButton).removeAttr("style")},dynamicFilter:{isEnabled:!1,init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.dynamicFilter.isEnabled=!0)},validate:function(a){var b,e,c=null,d=null;for(var f in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(f)&&(e=~f.indexOf(".")?this.helper.namespace(f,a,"get"):a[f],"|"!==this.filters.dynamic[f].modifier||c||(c=e==this.filters.dynamic[f].value||!1),"&"===this.filters.dynamic[f].modifier)){if(e!=this.filters.dynamic[f].value){d=!1;break}d=!0}return b=c,null!==d&&(b=d,d===!0&&null!==c&&(b=c)),!!b},set:function(a,b){var c=a.match(/^([|&])?(.+)/);b?this.filters.dynamic[c[2]]={modifier:c[1]||"|",value:b}:delete this.filters.dynamic[c[2]],this.dynamicFilter.isEnabled&&(this.searchResult(),this.buildLayout())},bind:function(){for(var c,b=this,d=0,e=this.options.dynamicFilter.length;d<e;d++)c=this.options.dynamicFilter[d],"string"==typeof c.selector&&(c.selector=a(c.selector)),c.selector instanceof a&&c.selector[0]&&c.key?!function(a){a.selector.off(b.namespace).on("change"+b.namespace,function(){b.dynamicFilter.set.apply(b,[a.key,b.dynamicFilter.getValue(this)])}).trigger("change"+b.namespace)}(c):this.options.debug&&(j.log({node:this.node.selector,function:"buildDynamicLayout()",message:'Invalid jQuery selector or jQuery Object for "filter.selector" or missing filter.key'}),j.print())},getValue:function(a){var b;return"SELECT"===a.tagName?b=a.value:"INPUT"===a.tagName&&("checkbox"===a.type?b=a.checked&&a.getAttribute("value")||a.checked||null:"radio"===a.type&&a.checked&&(b=a.value)),b}},showLayout:function(){if(!this.container.hasClass("result")&&(this.result.length||this.options.emptyTemplate||this.options.backdropOnFocus)){var b=this;a("html").off(this.namespace).on("click"+this.namespace+" touchend"+this.namespace,function(c){a(c.target).closest(b.container)[0]||b.hasDragged||b.hideLayout()}),this.container.addClass([this.result.length||this.options.emptyTemplate&&this.query.length>=this.options.minLength?"result ":"",this.options.hint&&this.query.length>=this.options.minLength?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query])}},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&a(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(a("html").off(this.namespace),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result={},this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&this.hint.container.val("")},resetInput:function(){this.node.val(""),this.item=null,this.query="",this.rawQuery=""},buildCancelButtonLayout:function(){if(this.options.cancelButton){var b=this;a("<span/>",{class:this.options.selector.cancelButton,mousedown:function(a){a.stopImmediatePropagation(),a.preventDefault(),b.resetInput(),b.node.trigger("input"+b.namespace,[a])}}).insertBefore(this.node)}},toggleCancelButton:function(){this.container.toggleClass("cancel",!!this.query.length)},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.delegateEvents(),this.buildCancelButtonLayout(),this.buildDropdownLayout(),this.buildDropdownItemLayout("static"),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},removeAccent:function(a){if("string"==typeof a){var b=d;return"object"==typeof this.options.accent&&(b=this.options.accent),a=a.toLowerCase().replace(new RegExp("["+b.from+"]","g"),function(a){return b.to[b.from.indexOf(a)]})}},slugify:function(a){return a=String(a),""!==a&&(a=this.helper.removeAccent.call(this,a),a=a.replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")),a},sort:function(a,b,c){var d=function(b){for(var d=0,e=a.length;d<e;d++)if("undefined"!=typeof b[a[d]])return c(b[a[d]]);return b};return b=[-1,1][+!!b],function(a,c){return a=d(a),c=d(c),b*((a>c)-(c>a))}},replaceAt:function(a,b,c,d){return a.substring(0,b)+d+a.substring(b+c)},highlight:function(a,b,c){a=String(a);var d=c&&this.helper.removeAccent.call(this,a)||a,e=[];Array.isArray(b)||(b=[b]),b.sort(function(a,b){return b.length-a.length});for(var f=b.length-1;f>=0;f--)""!==b[f].trim()?b[f]=b[f].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):b.splice(f,1);d.replace(new RegExp("(?:"+b.join("|")+")(?!([^<]+)?>)","gi"),function(a,b,c){e.push({offset:c,length:a.length})});for(var f=e.length-1;f>=0;f--)a=this.helper.replaceAt(a,e[f].offset,e[f].length,"<strong>"+a.substr(e[f].offset,e[f].length)+"</strong>");return a},getCaret:function(a){if(a.selectionStart)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();if(null===b)return 0;var c=a.createTextRange(),d=c.duplicate();return c.moveToBookmark(b.getBookmark()),d.setEndPoint("EndToStart",c),d.text.length}return 0},cleanStringFromScript:function(a){return"string"==typeof a&&a.replace(/<\/?(?:script|iframe)\b[^>]*>/gm,"")||a},executeCallback:function(a,b){if(a){var c;if("function"==typeof a)c=a;else if(("string"==typeof a||Array.isArray(a))&&("string"==typeof a&&(a=[a,[]]),c=this.helper.namespace(a[0],window),"function"!=typeof c))return void(this.options.debug&&(j.log({node:this.selector,function:"executeCallback()",arguments:JSON.stringify(a),message:'WARNING - Invalid callback function"'}),j.print()));return c.apply(this,(a[1]||[]).concat(b?b:[]))}},namespace:function(a,b,c,d){if("string"!=typeof a||""===a)return this.options.debug&&(j.log({node:_node.selector,function:"namespace()",arguments:a,message:'ERROR - Missing namespaceString"'}),j.print()),!1;for(var e=a.split("."),f=b||window,c=c||"get",g=d||{},h="",i=0,k=e.length;i<k;i++){if(h=e[i],"undefined"==typeof f[h]){if(~["get","delete"].indexOf(c))return"undefined"!=typeof d?d:void 0;f[h]={}}if(~["set","create","delete"].indexOf(c)&&i===k-1){if("set"!==c&&"create"!==c)return delete f[h],!0;f[h]=g}f=f[h]}return f},typeWatch:function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}()}},a.fn.typeahead=a.typeahead=function(a){return i.typeahead(this,a)};var i={typeahead:function(b,c){if(!c||!c.source||"object"!=typeof c.source)return j.log({node:b.selector||c&&c.input,function:"$.typeahead()",arguments:JSON.stringify(c&&c.source||""),message:'Undefined "options" or "options.source" or invalid source type - Typeahead dropped'}),void j.print();if("function"==typeof b){if(!c.input)return j.log({node:b.selector,function:"$.typeahead()",message:'Undefined "options.input" - Typeahead dropped'}),void j.print();b=a(c.input)}return b.length&&"INPUT"===b[0].nodeName?(c.input&&!b.selector&&(b.selector=c.input),window.Typeahead[c.input||b.selector]=new h(b,c)):(j.log({node:b.selector,function:"$.typeahead()",arguments:JSON.stringify(c.input),message:"Unable to find jQuery input element - Typeahead dropped"}),void j.print())}},j={table:{},log:function(b){b.message&&"string"==typeof b.message&&(this.table[b.message]=a.extend({node:"",function:"",arguments:""},b))},print:function(){!h.prototype.helper.isEmpty(this.table)&&console&&console.table&&(void 0===console.group&&void 0===console.table||(console.groupCollapsed("--- jQuery Typeahead Debug ---"),console.table(this.table),console.groupEnd()),this.table={})}};return j.log({message:"WARNING - You are using the DEBUG version. Use /dist/jquery.typeahead.min.js in production."}),j.print(),window.console=window.console||{log:function(){}},Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,b){void 0===b&&(b=0),b<0&&(b+=this.length),b<0&&(b=0);for(var c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1}),Object.keys||(Object.keys=function(a){var c,b=[];for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),h});